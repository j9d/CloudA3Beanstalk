<!DOCTYPE html>
<html lang="en">

<head>
    <title>Saved itineraries</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="styles/styles.css">
    <script rel="scripts" type="text/javascript">
        // Function for adding destination selection fields to the form
        function addFields() {
            // Number of destinations to create
            let number = document.getElementById('numlocations').value;

            if (number > 20) {
                alert('Too many destinations. Please choose 20 or less.');

            } else {
                // Container <div> where the location selections will be displayed
                let container = document.getElementById('container');

                // Clear previous contents of the container - allows changing of the number of destinations
                while (container.hasChildNodes()) {
                    container.removeChild(container.lastChild);
                }
                for (let i = 1; i <= number; i++) {
                    container.appendChild(document.createElement('hr'));

                    // Clone the selector for the origin location
                    let clone = document.querySelector('#origin').cloneNode(true);
                    clone.id = 'destination' + i;
                    clone.name = 'destination' + i;

                    container.appendChild(document.createTextNode('Destination ' + i));
                    container.appendChild(document.createElement('br'));
                    // Add the cloned element to the container
                    container.appendChild(clone);
                    container.appendChild(document.createElement('br'));

                    // Create a date selector for each destination
                    let date = document.createElement('input');
                    date.type = 'date';
                    date.id = 'date' + i;
                    date.name = 'date' + i;
                    date.value = '<?= date('Y - m - d') ?>';
                    date.min = '<?= date('Y - m - d') ?>';
                    date.onchange = updateMinDatesWrapper;

                    // Add date selector
                    container.appendChild(document.createTextNode('Date of departure from this destination:'));
                    container.appendChild(document.createElement('br'));
                    container.appendChild(date);

                    container.appendChild(document.createElement('br'));
                }
            }
        }

        function updateMinDatesWrapper(event) {
            updateMinDates(event.target);
        }

        function updateMinDates(item) {
            id = item.id;
            let num = parseInt(id.replace('date', ''), 10);
            let new_min = document.getElementById('date' + num).value;

            for (let i = num + 1; i <= 20; i++) {
                let dateselector = document.getElementById('date' + i);
                dateselector.min = new_min;
                let current_val = new Date(dateselector.value);
                let new_min_date = new Date(new_min);
                if (current_val < new_min_date) {
                    dateselector.value = new_min;
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container-fluid" id="main-title">
        <div class="col-lg-3"></div>
        <div class="col-lg-6 text-center">
            <h1 id="title">Itinerary App</h1>
        </div>
        <div class="col-lg-3"></div>
    </div>

    <div class="row section container-fluid" id="navigation-bar">
        <div class="col-lg-1"></div>
        <div class="col-lg-8">
            <nav class="collapse navbar-collapse">
                <div class="navbar-nav">
                    <ul class="nav navbar-nav mr-auto justify-content-end">
                        <li class="nav-item">
                            <a href='new_itinerary.php' id="nav-links">New itinerary</a>
                        </li>
                        <li class="nav-item">
                            <a href='user.php' id="nav-links">Past itineraries</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="col-lg-3">
            <nav class="collapse navbar-collapse">
                <div class="navbar-nav">
                    <ul class="nav navbar-nav mr-auto justify-content-end">
                        <li class="nav-item">
                            <p>username and logout go here</p>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <div class="row section container-fluid" id="main-body">
        <div class="col-lg-3"></div>
        <div class="col-lg-6">
            <h2 id="page-title">Saved Itinerary</h2>
            <hr>
            <div class="container-fluid">
                <p><strong>Origin</strong></p>
                <p><?= $itinerary[0]['M']['city']['S'] . ', ' . $itinerary[0]['M']['country']['S'] ?></p>
                <p><strong>Depart on </strong><?= (new DateTime($itinerary[0]['M']['date']['S']))->format('jS F Y') ?></p>
                <hr>
            </div>

            <?php
            foreach ($itinerary as $index => $location) {
                if ($index > 0) {
                    $combinedname = $itinerary[$index]['M']['city']['S'] . ', ' . $itinerary[$index]['M']['country']['S'];
                    $arrdate = (new DateTime($itinerary[$index - 1]['M']['date']['S']))->format('jS F Y');
                    $depdate = (new DateTime($itinerary[$index]['M']['date']['S']))->format('jS F Y');
                    echo '<div>
                        <p><strong>Destination ' . $index . '</strong></p>
                        <p>' . $combinedname . '</p>
                        <p><strong>Arrive on </strong>' . $arrdate . '</p>
                        <p><strong>Depart on </strong>' . $depdate . '</p>
                    </div>
                    <hr/>';
                }
            }
            ?>

            <p><strong>Return Destination</strong></p>
            <p><?= $itinerary[0]['M']['city']['S'] . ', ' . $itinerary[0]['M']['country']['S'] ?></p>
            <p><strong>Arrive on </strong><?= (new DateTime($itinerary[count($itinerary) - 1]['M']['date']['S']))->format('jS F Y') ?></p>
            <hr>

            <form action="user.php" method="POST"><input class="form-control" type="submit" value="Back"></form>
            <form action="email.php" method="POST"><input class="form-control" type="submit" value="Email to me"></form>
        </div>
        <div class="col-lg-3"></div>
    </div>
</body>

<footer class="container-fluid" id="footer">
    <div>
        <p>COSC2626 Cloud Computing - Assessment 3</p>
        <p><span>&#169;</span>James Dimos (s3722398)<br>
            <span>&#169;</span>Louis Manabat (s3719633)
        </p>
    </div>
</footer>

</html>